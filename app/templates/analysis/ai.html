{% extends 'base.html' %}

{% block title %}AI Analyse | Aksjeradar{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb" class="my-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Hjem</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('analysis.index') }}">Analyse</a></li>
            <li class="breadcrumb-item active">AI Analyse</li>
        </ol>
    </nav>

    {% include 'analysis/_menu.html' %}
    
    <div class="card border-0 shadow mb-4">
        <div class="card-header bg-info text-white">
            <h2 class="h5 mb-0">AI Analyse</h2>
        </div>
        <div class="card-body">
            <p class="lead">Vår AI-analyse kombinerer tekniske indikatorer, markedssentiment og fundamentale faktorer for å gi deg en dypere innsikt i aksjer.</p>
            
            <form method="GET" action="{{ url_for('analysis.ai') }}" class="mb-4">
                <div class="input-group">
                    <input type="text" name="ticker" class="form-control" placeholder="Skriv inn ticker (f.eks. EQNR.OL, AAPL)" value="{{ ticker or '' }}" required>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i> Analyser
                    </button>
                </div>
                <div class="form-text">Skriv inn en aksjeticker for å få en AI-drevet analyse.</div>
            </form>
            
            {% if ticker %}
                <h3>{{ ticker }}</h3>
                
                {% if error %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        {{ error }}
                    </div>
                    
                    <!-- Fallback content with sample analysis for common tickers -->
                    {% if ticker in ['EQNR.OL', 'DNB.OL', 'AAPL', 'MSFT', 'TSLA', 'BTC-USD'] %}
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            Viser demo-analyse for {{ ticker }}
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4 class="h5 mb-0">AI Markedsanalyse</h4>
                            </div>
                            <div class="card-body">
                                {% if ticker == 'EQNR.OL' %}
                                    <p class="lead">Equinor viser en <strong class="text-success">moderat bullish</strong> tendens basert på vår AI-analyse.</p>
                                    <p>Analysen indikerer positiv momentum for energisektoren med økende oljepriser. Equinor er godt posisjonert med sterk kontantstrøm og pågående investeringer i fornybar energi.</p>
                                {% elif ticker == 'DNB.OL' %}
                                    <p class="lead">DNB viser en <strong class="text-secondary">nøytral</strong> tendens basert på vår AI-analyse.</p>
                                    <p>Analysen indikerer stabil inntjening, men utfordringer fra rentemiljøet. Bankens kapitalposisjon er solid, men vekstmulighetene er begrensede på kort sikt.</p>
                                {% elif ticker == 'AAPL' %}
                                    <p class="lead">Apple viser en <strong class="text-success">sterk bullish</strong> tendens basert på vår AI-analyse.</p>
                                    <p>Analysen indikerer fortsatt sterk etterspørsel etter Apple-produkter og vekst i serviceinntekter. Selskapet viser motstandsdyktighet mot makroøkonomiske utfordringer og har solid innovasjonshistorikk.</p>
                                {% elif ticker == 'MSFT' %}
                                    <p class="lead">Microsoft viser en <strong class="text-success">sterk bullish</strong> tendens basert på vår AI-analyse.</p>
                                    <p>Analysen indikerer akselererende vekst i Azure skyplattform og sterke resultater fra AI-investeringer. Microsoft er strategisk posisjonert for langsiktig vekst i både skyteknologi og AI.</p>
                                {% elif ticker == 'TSLA' %}
                                    <p class="lead">Tesla viser en <strong class="text-danger">moderat bearish</strong> tendens basert på vår AI-analyse.</p>
                                    <p>Analysen indikerer press på marginer fra økende konkurranse i EV-markedet. Produksjonsmål er ambisiøse, men kan møte utfordringer fra leverandørkjeder og makroøkonomiske faktorer.</p>
                                {% elif ticker == 'BTC-USD' %}
                                    <p class="lead">Bitcoin viser en <strong class="text-success">moderat bullish</strong> tendens basert på vår AI-analyse.</p>
                                    <p>Analysen indikerer positiv momentum etter den siste halveringen og økende institusjonell adopsjon. Regulatorisk usikkerhet forblir en risikofaktor, men markedssentimentet er generelt positivt.</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h4 class="h5 mb-0">Tekniske faktorer</h4>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            {% if ticker == 'EQNR.OL' %}
                                                <li class="list-group-item">RSI på 58.2 indikerer moderat oppkjøpt tilstand</li>
                                                <li class="list-group-item">Prisutvikling over både 50 og 200-dagers glidende gjennomsnitt</li>
                                                <li class="list-group-item">MACD viser positive krysninger som indikerer bullish momentum</li>
                                            {% elif ticker == 'DNB.OL' %}
                                                <li class="list-group-item">RSI på 52.3 indikerer nøytral tilstand</li>
                                                <li class="list-group-item">Pris svinger rundt 50-dagers glidende gjennomsnitt</li>
                                                <li class="list-group-item">Volumanalyse viser moderat handelsaktivitet</li>
                                            {% elif ticker == 'AAPL' %}
                                                <li class="list-group-item">RSI på 61.5 indikerer moderat oppkjøpt tilstand</li>
                                                <li class="list-group-item">Bullish flaggformasjon i prisdiagrammet</li>
                                                <li class="list-group-item">Sterkt positivt volumprofil med institusjonell kjøpsaktivitet</li>
                                            {% elif ticker == 'MSFT' %}
                                                <li class="list-group-item">RSI på 72.3 indikerer overkjøpt tilstand, mulig kortsiktig korreksjon</li>
                                                <li class="list-group-item">Kursen handler klart over alle viktige glidende gjennomsnitt</li>
                                                <li class="list-group-item">Stigende trendlinje intakt siden mars 2023</li>
                                            {% elif ticker == 'TSLA' %}
                                                <li class="list-group-item">RSI på 38.4 nærmer seg oversolgt område</li>
                                                <li class="list-group-item">Kurs under 50-dagers glidende gjennomsnitt</li>
                                                <li class="list-group-item">Nedadgående trendkanal med gjentatte mislykkede utbruddsforsøk</li>
                                            {% elif ticker == 'BTC-USD' %}
                                                <li class="list-group-item">RSI på 68.3 indikerer nær overkjøpt tilstand</li>
                                                <li class="list-group-item">Handlet over alle viktige glidende gjennomsnitt</li>
                                                <li class="list-group-item">Volumprofil viser økende kjøpsinteresse etter siste halveringen</li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h4 class="h5 mb-0">Fundamentale faktorer</h4>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            {% if ticker == 'EQNR.OL' %}
                                                <li class="list-group-item">Sterk kontantstrøm fra kjernevirksomheten</li>
                                                <li class="list-group-item">Attraktiv utbyttepolitikk med yield på 4.2%</li>
                                                <li class="list-group-item">Økende investeringer i fornybare energiprosjekter</li>
                                            {% elif ticker == 'DNB.OL' %}
                                                <li class="list-group-item">Solid kapitalposisjon med Tier 1-kapitaldekning over krav</li>
                                                <li class="list-group-item">Moderat utlånsvekst i private og bedriftsmarkedet</li>
                                                <li class="list-group-item">Utbytteavkastning på 3.8% med potensial for økning</li>
                                            {% elif ticker == 'AAPL' %}
                                                <li class="list-group-item">Sterk vekst i serviceinntekter med høye marginer</li>
                                                <li class="list-group-item">Robust balanse med betydelige kontantreserver</li>
                                                <li class="list-group-item">Fortsatt sterk merkevarelojalitet og økosystemeffekter</li>
                                            {% elif ticker == 'MSFT' %}
                                                <li class="list-group-item">Azure cloud-tjeneste viser akselererende vekst</li>
                                                <li class="list-group-item">Sterk posisjon i AI med OpenAI-integrasjoner</li>
                                                <li class="list-group-item">Diversifiserte inntektsstrømmer fra flere produktlinjer</li>
                                            {% elif ticker == 'TSLA' %}
                                                <li class="list-group-item">Press på bruttomarginer fra priskonkurranse</li>
                                                <li class="list-group-item">Utfordringer med å nå leveransemål for nye modeller</li>
                                                <li class="list-group-item">Høy verdsettelse relativt til andre bilprodusenter</li>
                                            {% elif ticker == 'BTC-USD' %}
                                                <li class="list-group-item">Redusert utstedelsesrate etter halveringen</li>
                                                <li class="list-group-item">Økende institusjonell adopsjon gjennom ETF-er</li>
                                                <li class="list-group-item">Korrelasjon med tradisjonelle finansmarkeder forblir høy</li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>                        </div>
                        
                        {% if ticker == 'BTC-USD' or ticker == 'ETH-USD' or ticker == 'XRP-USD' or ticker == 'ADA-USD' or ticker == 'LTC-USD' %}
                            <div class="alert alert-info mb-4">
                                <h4 class="alert-heading"><i class="bi bi-info-circle me-2"></i>Om kryptovaluta-analyse</h4>
                                <p>Kryptovalutaer har unike markedskarakteristikker som skiller dem fra tradisjonelle aksjer og valutaer:</p>
                                <ul>
                                    <li><strong>Høy volatilitet</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Kryptovalutaer kan oppleve ekstreme prisbevegelser på kort tid, noe som øker både risiko og muligheter"></i></li>
                                    <li><strong>24/7 handelsmarked</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Til forskjell fra tradisjonelle markeder, handles krypto kontinuerlig uten stengetid"></i></li>
                                    <li><strong>Regulatorisk påvirkning</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Myndigheters reguleringsendringer kan ha umiddelbar og signifikant påvirkning på kryptokurser"></i></li>
                                    <li><strong>Halveringseffekter</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="For Bitcoin og noen andre kryptovalutaer: en periodisk halvering av utvinningsbelønningen som historisk har påvirket prisen"></i></li>
                                    <li><strong>Nettverksutvikling</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Oppgraderinger og utviklingsmilestolper i underliggende teknologi kan drive prisendringer"></i></li>
                                </ul>
                            </div>
                        {% elif ticker == 'EURUSD=X' or ticker == 'GBPUSD=X' or ticker == 'USDJPY=X' or ticker == 'USDCNY=X' or ticker == 'NOKUSD=X' %}
                            <div class="alert alert-info mb-4">
                                <h4 class="alert-heading"><i class="bi bi-info-circle me-2"></i>Om valutaanalyse</h4>
                                <p>Valutamarkedet (Forex) har særegne karakteristikker:</p>
                                <ul>
                                    <li><strong>Renteforskjeller</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Forskjeller i renter mellom land er en hoveddriver for valutakurser - høyere renter tiltrekker seg kapital"></i></li>
                                    <li><strong>Økonomiske indikatorer</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Nøkkeltall som BNP, inflasjon, arbeidsledighet og handelsbalanse påvirker valutaers relative styrke"></i></li>
                                    <li><strong>Sentralbankpolitikk</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Sentralbankers uttalelser og handlinger er kritiske for valutabevegelser"></i></li>
                                    <li><strong>Geopolitisk risiko</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Internasjonale hendelser, konflikter og politisk ustabilitet kan drive 'trygg havn'-bevegelser i valutamarkedet"></i></li>
                                    <li><strong>Intermarket-relasjoner</strong> <i class="bi bi-info-circle ms-1 text-primary" data-bs-toggle="tooltip" title="Sammenhenger med andre markeder som råvarer (særlig for NOK og oljepriser) kan påvirke kursbevegelser"></i></li>
                                </ul>
                            </div>
                        {% endif %}
                        
                        <div class="card">
                            <div class="card-header">
                                <h4 class="h5 mb-0">Konklusjon og anbefaling</h4>
                            </div>
                            <div class="card-body">
                                {% if ticker == 'EQNR.OL' %}
                                    <div class="alert alert-success">
                                        <i class="bi bi-check-circle-fill me-2"></i>
                                        <strong>Anbefaling: KjØP</strong>
                                    </div>
                                    <p>Equinor viser sterk finansiell stilling og gunstige markedsforhold i energisektoren. Med solid utbytteavkastning og positiv teknisk trend fremstår aksjen som attraktiv på gjeldende nivåer.</p>
                                {% elif ticker == 'DNB.OL' %}
                                    <div class="alert alert-secondary">
                                        <i class="bi bi-dash-circle-fill me-2"></i>
                                        <strong>Anbefaling: HOLD</strong>
                                    </div>
                                    <p>DNB viser solide fundamentale forhold, men med begrensede vekstmuligheter på kort sikt. Anbefaler å holde eksisterende posisjoner og avvente ytterligere signaler før nye kjøp.</p>
                                {% elif ticker == 'AAPL' %}
                                    <div class="alert alert-success">
                                        <i class="bi bi-check-circle-fill me-2"></i>
                                        <strong>Anbefaling: KjØP</strong>
                                    </div>
                                    <p>Apple viser fortsatt sterk vekst i høymargin-tjenester og robust økosystem. Tekniske indikatorer tyder på fortsatt oppside, og selskapets innovasjonsevne gir støtte for langsiktig vekst.</p>
                                {% elif ticker == 'MSFT' %}
                                    <div class="alert alert-success">
                                        <i class="bi bi-check-circle-fill me-2"></i>
                                        <strong>Anbefaling: KjØP</strong>
                                    </div>
                                    <p>Microsoft er godt posisjonert for langsiktig vekst med ledende posisjon i skytjenester og AI. Sterk kontantstrøm og diversifiserte inntektskilder gir støtte for videre kursoppgang.</p>
                                {% elif ticker == 'TSLA' %}
                                    <div class="alert alert-danger">
                                        <i class="bi bi-x-circle-fill me-2"></i>
                                        <strong>Anbefaling: SELG</strong>
                                    </div>
                                    <p>Tesla står overfor økende konkurransepress og utfordringer med å nå produksjonsmål. Den høye verdsettelsen gir begrenset oppside og betydelig risiko på kort til mellomlang sikt.</p>
                                {% elif ticker == 'BTC-USD' %}
                                    <div class="alert alert-success">
                                        <i class="bi bi-check-circle-fill me-2"></i>
                                        <strong>Anbefaling: KjØP</strong>
                                    </div>
                                    <p>Bitcoin viser positive tekniske signaler og økende institusjonell aksept etter halveringen. Langsiktig trend er positiv, men investorer bør være forberedt på fortsatt høy volatilitet.</p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% elif analysis %}                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4 class="h5 mb-0">AI Markedsanalyse</h4>
                            <a href="#" class="text-muted" data-bs-toggle="tooltip" title="AI-analysen kombinerer tekniske indikatorer, markedssentiment og fundamentale faktorer for å gi en helhetlig vurdering.">
                                <i class="bi bi-info-circle"></i>
                            </a>
                        </div>
                        <div class="card-body">
                            <p class="lead">{{ ticker }} viser en <strong class="{{ 'text-success' if analysis.sentiment == 'bullish' else ('text-danger' if analysis.sentiment == 'bearish' else 'text-secondary') }}">{{ analysis.strength }} {{ analysis.sentiment }}</strong> tendens basert på vår AI-analyse.</p>
                            <p>{{ analysis.summary }}</p>
                            
                            {% if analysis.prediction.target_price is defined %}
                            <div class="alert {{ 'alert-success' if analysis.prediction.direction == 'up' else ('alert-danger' if analysis.prediction.direction == 'down' else 'alert-secondary') }} d-flex align-items-center">
                                <div class="me-3 fs-2">
                                    <i class="bi {{ 'bi-graph-up-arrow' if analysis.prediction.direction == 'up' else ('bi-graph-down-arrow' if analysis.prediction.direction == 'down' else 'bi-arrow-left-right') }}"></i>
                                </div>
                                <div>
                                    <h5 class="alert-heading">Prismål: {{ analysis.prediction.target_price }}</h5>
                                    <p class="mb-0">Tidshorisont: {{ analysis.prediction.time_frame }}</p>
                                </div>
                            </div>
                            {% endif %}
                            
                            <div class="mt-4">
                                <h5 class="h6">Nøkkelbegreper i denne analysen:</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="list-unstyled small">
                                            <li class="mb-2">
                                                <span class="fw-bold">RSI</span> 
                                                <a href="#" class="text-muted ms-1" data-bs-toggle="tooltip" title="Relative Strength Index - En teknisk indikator som måler styrken av en aksjes kursutvikling basert på siste lukkekurser. Verdier over 70 indikerer overkjøpt, under 30 indikerer oversolgt.">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </a>
                                            </li>
                                            <li class="mb-2">
                                                <span class="fw-bold">MACD</span> 
                                                <a href="#" class="text-muted ms-1" data-bs-toggle="tooltip" title="Moving Average Convergence Divergence - En trendindikator som viser forholdet mellom to glidende gjennomsnitt av en aksjes kurs.">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </a>
                                            </li>
                                            <li class="mb-2">
                                                <span class="fw-bold">Glidende gjennomsnitt</span> 
                                                <a href="#" class="text-muted ms-1" data-bs-toggle="tooltip" title="Et gjennomsnitt av en aksjes kurs over en bestemt tidsperiode, brukes for å identifisere trender.">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <ul class="list-unstyled small">
                                            <li class="mb-2">
                                                <span class="fw-bold">Bullish</span> 
                                                <a href="#" class="text-muted ms-1" data-bs-toggle="tooltip" title="En optimistisk markedsforventning der man tror prisen vil stige.">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </a>
                                            </li>
                                            <li class="mb-2">
                                                <span class="fw-bold">Bearish</span> 
                                                <a href="#" class="text-muted ms-1" data-bs-toggle="tooltip" title="En pessimistisk markedsforventning der man tror prisen vil falle.">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </a>
                                            </li>
                                            <li class="mb-2">
                                                <span class="fw-bold">Konsolidering</span> 
                                                <a href="#" class="text-muted ms-1" data-bs-toggle="tooltip" title="En periode der kursen beveger seg sidelengs i et avgrenset område, ofte før neste større kursbevegelse.">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6 mb-4 mb-md-0">
                            <div class="card h-100 border-0 shadow">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h4 class="h5 mb-0">Tekniske faktorer</h4>
                                    <a href="#" class="text-muted" data-bs-toggle="tooltip" title="Teknisk analyse fokuserer på prishistorikk, volum og matematiske indikatorer for å forutsi fremtidige prisbevegelser.">
                                        <i class="bi bi-info-circle"></i>
                                    </a>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        {% for factor in analysis.technical_factors %}
                                        <li class="list-group-item d-flex align-items-start">
                                            <i class="bi {{ 'bi-arrow-up-circle text-success' if 'over' in factor|lower and not 'overkjøpt' in factor|lower else ('bi-arrow-down-circle text-danger' if 'under' in factor|lower or 'oversolgt' in factor|lower else 'bi-dot') }} me-2 mt-1"></i>
                                            <span>{{ factor }}</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="card-footer bg-light">
                                    <div class="small text-muted">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Tekniske indikatorer viser {{ 'positiv' if analysis.sentiment == 'bullish' else ('negativ' if analysis.sentiment == 'bearish' else 'nøytral') }} trend
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h4 class="h5 mb-0">Fundamentale faktorer</h4>
                                    <a href="#" class="text-muted" data-bs-toggle="tooltip" title="Fundamental analyse vurderer selskapets underliggende økonomiske forhold, inkludert inntekter, utgifter, eiendeler, forpliktelser og vekstpotensial.">
                                        <i class="bi bi-info-circle"></i>
                                    </a>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        {% for factor in analysis.fundamental_factors %}
                                        <li class="list-group-item d-flex align-items-start">
                                            <i class="bi {{ 'bi-check-circle text-success' if 'sterk' in factor|lower or 'vekst' in factor|lower or 'øk' in factor|lower else ('bi-x-circle text-danger' if 'svak' in factor|lower or 'fall' in factor|lower or 'press' in factor|lower else 'bi-dot') }} me-2 mt-1"></i>
                                            <span>{{ factor }}</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="card-footer bg-light">
                                    <div class="small text-muted">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Fundamentale faktorer viser {{ 'sterk' if analysis.sentiment == 'bullish' else ('svak' if analysis.sentiment == 'bearish' else 'stabil') }} posisjon
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card border-0 shadow mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4 class="h5 mb-0">Konklusjon og anbefaling</h4>
                            <a href="#" class="text-muted" data-bs-toggle="tooltip" title="AI-analysen sammenstiller alle faktorer for å gi en helhetlig anbefaling basert på teknisk analyse, fundamentale faktorer og markedssentiment.">
                                <i class="bi bi-info-circle"></i>
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-6 mb-4 mb-md-0">
                                    <div class="alert {{ 'alert-success' if analysis.prediction.direction == 'up' else ('alert-danger' if analysis.prediction.direction == 'down' else 'alert-secondary') }} mb-0">
                                        <i class="bi {{ 'bi-check-circle-fill' if analysis.prediction.direction == 'up' else ('bi-x-circle-fill' if analysis.prediction.direction == 'down' else 'bi-dash-circle-fill') }} me-2"></i>
                                        <strong>Anbefaling: {{ 'KJØP' if analysis.prediction.direction == 'up' else ('SELG' if analysis.prediction.direction == 'down' else 'HOLD') }}</strong>
                                        <div class="mt-2">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <span>Konfidens:</span>
                                                <span>{{ (analysis.prediction.confidence * 100)|round|int }}%</span>
                                            </div>
                                            <div class="progress" style="height: 8px;" data-bs-toggle="tooltip" title="Konfidensgrad i anbefalingen basert på AI-modellens sikkerhet">
                                                <div class="progress-bar {{ 'bg-success' if analysis.prediction.direction == 'up' else ('bg-danger' if analysis.prediction.direction == 'down' else 'bg-secondary') }}" role="progressbar" style="width: {{ (analysis.prediction.confidence * 100)|round|int }}%" aria-valuenow="{{ (analysis.prediction.confidence * 100)|round|int }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="sentiment-meter text-center">
                                        <h6>Sentimentmåler</h6>
                                        <div class="progress mb-2" style="height: 30px;">
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 33%" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">Bearish</div>
                                            <div class="progress-bar bg-secondary" role="progressbar" style="width: 34%" aria-valuenow="34" aria-valuemin="0" aria-valuemax="100">Nøytral</div>
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 33%" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">Bullish</div>
                                        </div>
                                        <div class="position-relative" style="height: 20px;">
                                            {% set sentiment_value = 0 %}
                                            {% if analysis.sentiment == 'bullish' %}
                                                {% if analysis.strength == 'strong' %}
                                                    {% set sentiment_value = 90 %}
                                                {% elif analysis.strength == 'moderate' %}
                                                    {% set sentiment_value = 75 %}
                                                {% else %}
                                                    {% set sentiment_value = 60 %}
                                                {% endif %}
                                            {% elif analysis.sentiment == 'bearish' %}
                                                {% if analysis.strength == 'strong' %}
                                                    {% set sentiment_value = 10 %}
                                                {% elif analysis.strength == 'moderate' %}
                                                    {% set sentiment_value = 25 %}
                                                {% else %}
                                                    {% set sentiment_value = 40 %}
                                                {% endif %}
                                            {% else %}
                                                {% set sentiment_value = 50 %}
                                            {% endif %}
                                            
                                            <div class="position-absolute" style="left: {{ sentiment_value }}%; top: -10px; transform: translateX(-50%);">
                                                <i class="bi bi-caret-down-fill fs-4 text-primary"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <p class="mb-0">Basert på vår analyse er {{ ticker }} forventet å bevege seg {{ 'oppover' if analysis.prediction.direction == 'up' else ('nedover' if analysis.prediction.direction == 'down' else 'sidelengs') }} i {{ analysis.prediction.time_frame }}. Datoen for denne analysen er {{ analysis.generated_at }}.</p>
                            </div>
                            
                            <div class="card mt-4 bg-light border-0">
                                <div class="card-body">
                                    <h5 class="h6 mb-3">Prismål: {{ analysis.prediction.target_price }}</h5>
                                    <div class="d-flex align-items-center">
                                        <div style="width: 40px; height: 40px;" class="d-flex align-items-center justify-content-center rounded-circle {{ 'bg-success text-white' if analysis.prediction.direction == 'up' else ('bg-danger text-white' if analysis.prediction.direction == 'down' else 'bg-secondary text-white') }} me-3">
                                            <i class="bi {{ 'bi-graph-up-arrow' if analysis.prediction.direction == 'up' else ('bi-graph-down-arrow' if analysis.prediction.direction == 'down' else 'bi-arrow-left-right') }}"></i>
                                        </div>
                                        <div>
                                            <p class="mb-0">
                                                {{ 'Stigende' if analysis.prediction.direction == 'up' else ('Fallende' if analysis.prediction.direction == 'down' else 'Sidelengs') }} momentum forventet 
                                                med {{ (analysis.prediction.confidence * 100)|round|int }}% konfidens.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {% if analysis.economic_indicators is defined %}
                    <div class="card border-0 shadow mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4 class="h5 mb-0">Økonomiske indikatorer</h4>
                            <a href="#" class="text-muted" data-bs-toggle="tooltip" title="Makroøkonomiske faktorer og markedstrender som påvirker aksjen.">
                                <i class="bi bi-info-circle"></i>
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% for key, value in analysis.economic_indicators.items() %}
                                <div class="col-md-6 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3">
                                            <i class="bi bi-graph-up-arrow text-muted"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-1 text-capitalize">{{ key.replace('_', ' ') }}</h6>
                                            <p class="mb-0 small">{{ value }}</p>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            {% else %}
                <!-- Populære aksjer -->
                <div class="card mt-4 border-0 shadow">
                    <div class="card-header bg-light">
                        <h4 class="h5 mb-0">Populære aksjer for AI-analyse</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-4">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="h6 mb-0">Oslo Børs</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <a href="{{ url_for('analysis.ai') }}?ticker=EQNR.OL" class="btn btn-outline-primary btn-sm d-flex justify-content-between align-items-center">
                                                <span>EQNR.OL - Equinor</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=DNB.OL" class="btn btn-outline-primary btn-sm d-flex justify-content-between align-items-center">
                                                <span>DNB.OL - DNB Bank</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=TEL.OL" class="btn btn-outline-primary btn-sm d-flex justify-content-between align-items-center">
                                                <span>TEL.OL - Telenor</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=YAR.OL" class="btn btn-outline-primary btn-sm d-flex justify-content-between align-items-center">
                                                <span>YAR.OL - Yara International</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=NHY.OL" class="btn btn-outline-primary btn-sm d-flex justify-content-between align-items-center">
                                                <span>NHY.OL - Norsk Hydro</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="h6 mb-0">Global</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <a href="{{ url_for('analysis.ai') }}?ticker=AAPL" class="btn btn-outline-success btn-sm d-flex justify-content-between align-items-center">
                                                <span>AAPL - Apple Inc</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=MSFT" class="btn btn-outline-success btn-sm d-flex justify-content-between align-items-center">
                                                <span>MSFT - Microsoft</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=GOOGL" class="btn btn-outline-success btn-sm d-flex justify-content-between align-items-center">
                                                <span>GOOGL - Alphabet</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=AMZN" class="btn btn-outline-success btn-sm d-flex justify-content-between align-items-center">
                                                <span>AMZN - Amazon</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=TSLA" class="btn btn-outline-success btn-sm d-flex justify-content-between align-items-center">
                                                <span>TSLA - Tesla</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="h6 mb-0">Krypto</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <a href="{{ url_for('analysis.ai') }}?ticker=BTC-USD" class="btn btn-outline-info btn-sm d-flex justify-content-between align-items-center">
                                                <span>BTC-USD - Bitcoin</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=ETH-USD" class="btn btn-outline-info btn-sm d-flex justify-content-between align-items-center">
                                                <span>ETH-USD - Ethereum</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=XRP-USD" class="btn btn-outline-info btn-sm d-flex justify-content-between align-items-center">
                                                <span>XRP-USD - Ripple</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=ADA-USD" class="btn btn-outline-info btn-sm d-flex justify-content-between align-items-center">
                                                <span>ADA-USD - Cardano</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                            <a href="{{ url_for('analysis.ai') }}?ticker=SOL-USD" class="btn btn-outline-info btn-sm d-flex justify-content-between align-items-center">
                                                <span>SOL-USD - Solana</span>
                                                <i class="bi bi-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Om AI-analyse -->
                <div class="card mt-4 border-0 shadow">
                    <div class="card-header bg-info text-white">
                        <h4 class="h5 mb-0">Om AI-analyse</h4>
                    </div>
                    <div class="card-body">
                        <p>Vår AI-analyse kombinerer flere datakilder og analysemetoder for å gi deg en omfattende vurdering:</p>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="rounded-circle bg-primary text-white p-2 me-3">
                                                <i class="bi bi-graph-up"></i>
                                            </div>
                                            <h5 class="card-title mb-0">Teknisk analyse</h5>
                                        </div>
                                        <p class="card-text">Identifiserer mønstre, trender og signaler i historiske kursdata ved hjelp av matematiske indikatorer som RSI, MACD og glidende gjennomsnitt.</p>
                                        <div class="mt-3">
                                            <span class="badge bg-light text-dark me-1">RSI</span>
                                            <span class="badge bg-light text-dark me-1">MACD</span>
                                            <span class="badge bg-light text-dark">SMA/EMA</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="rounded-circle bg-success text-white p-2 me-3">
                                                <i class="bi bi-building"></i>
                                            </div>
                                            <h5 class="card-title mb-0">Fundamental analyse</h5>
                                        </div>
                                        <p class="card-text">Evaluerer selskapets økonomiske helse, vekstpotensial, konkurranseposisjon og verdsettelse basert på finansielle nøkkeltall og markedstrender.</p>
                                        <div class="mt-3">
                                            <span class="badge bg-light text-dark me-1">P/E</span>
                                            <span class="badge bg-light text-dark me-1">EV/EBITDA</span>
                                            <span class="badge bg-light text-dark">Utbytte</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="rounded-circle bg-info text-white p-2 me-3">
                                                <i class="bi bi-chat-text"></i>
                                            </div>
                                            <h5 class="card-title mb-0">Markedssentiment</h5>
                                        </div>
                                        <p class="card-text">Analyserer nyheter, sosiale medier og analytikeranbefalinger for å måle markedets holdning til aksjen og identifisere endringer i sentiment.</p>
                                        <div class="mt-3">
                                            <span class="badge bg-light text-dark me-1">Nyheter</span>
                                            <span class="badge bg-light text-dark me-1">Analytikere</span>
                                            <span class="badge bg-light text-dark">Sosiale medier</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="alert alert-light border">
                                <i class="bi bi-info-circle-fill text-primary me-2"></i>
                                <strong>Merk:</strong> AI-analysene er ment som beslutningsstøtte og ikke som direkte investeringsråd. Analysen er basert på historiske data og markedsinformasjon, og fremtidige resultater kan avvike fra prognosene.
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Enable tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
    });
</script>
{% endblock %}
